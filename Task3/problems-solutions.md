## Проблемы

Проблемы и риски связанные с повышение нагрузки:
- долгое время ответа при частом запросе доступных продуктов, так как сервису нужно синхронно обойти каждое апи партнеров и получить данные
- неконсистентность данных между ins-product-aggregator и репликами в core-app и ins-comp-settlement
- увеличение объёма данных, которые необходимо хранить и обрабатывать в локальных репликах
- каскадный сбой из-за отказа одной компании-партнера
- если ins-product-aggregator станет недоступен, это повлияет на работу всех зависимых сервисов
- если апи партнеров недоступно, может получится ситуация, что данны о купленных полисах не будут отправлены в страховые компании

## Варианты решения

Решения:
- ins-product-aggregator может публиковать обновления данных о продуктах и тарифах в событийный поток (Event Stream)
- сервисы core-app и ins-comp-settlement будут подписываться на эти события и обновлять свои локальные реплики асинхронно
- core-app может публиковать события о новых страховках в поток
- ins-comp-settlement будет подписан на эти события и сможет обрабатывать их асинхронно, формируя реестр страховок

Для надежности можно использовать паттерн Transactional Outbox:

- сервис ins-product-aggregator при обновлении данных о продуктах и тарифах, после агрегации записывает событие в таблицу "outbox"
- фоновый процесс публикует события в поток
- сервисы core-app и ins-comp-settlement подписываются на этот поток и обновляют свои локальные реплики.
- сервис core-app при оформлениии новой страховки записывает данные в "outbox"
- фоновой процесс публикует события в поток
- ins-comp-settlement получает данные и сохраняет в свой реплики, чтобы в дальнейшем сформировать отчет